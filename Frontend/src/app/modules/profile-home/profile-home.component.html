<app-layout [logoutLink]="'/login'">
  <section class="page-container">
    <div class="card-base overflow-hidden border-orange-400">
      <div
        class="px-6 py-5 border-b border-yellow-200 bg-yellow-50 flex flex-col md:flex-row md:items-center md:justify-between gap-4 w-full"
      >
        <div class="flex items-center w-full md:w-auto">
          <div class="flex-shrink-0 mr-10">
            <img
              [src]="user?.photoUrl"
              (error)="onAvatarError($event)"
              alt="avatar"
              class="h-20 w-auto rounded-full object-cover border border-gray-200"
            />
          </div>

          <div class="flex flex-col min-w-0">
            <h1
              class="text-2xl md:text-3xl font-bold text-[#0D1440] leading-none"
            >
              {{ user?.firstName }} {{ user?.lastName }}
            </h1>

            <h4 class="text-sm text-gray-600 font-medium my-0 leading-none">
              {{ user?.role | titlecase }}
            </h4>

            <h4 class="text-sm text-gray-500 my-0 leading-none">
              {{ user?.email }}
            </h4>
          </div>
        </div>

        <button
          type="button"
          (click)="openDetails()"
          class="mt-3 md:mt-0 inline-flex items-center gap-2 px-5 py-2.5 rounded-md border border-gray-800 text-gray-900 font-semibold text-sm md:text-base hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300"
        >
          Ver detalles del cargo
        </button>
      </div>

      <div class="px-6 py-6 space-y-8">
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div
            class="rounded-2xl border border-orange-200 bg-orange-50 shadow-sm p-5 text-center"
          >
            <p
              class="text-xs uppercase tracking-wide text-yellow-700 font-semibold"
            >
              Actividades registradas
            </p>
            <h2 class="mt-3 text-3xl font-extrabold text-[#0D1440]">
              {{ activitiesCount }}
            </h2>
            <span class="mt-1 text-xs text-yellow-700 block">
              Total acumulado
            </span>
          </div>

          <div
            class="rounded-2xl border border-green-200 bg-green-50 shadow-sm p-5 text-center"
          >
            <p
              class="text-xs uppercase tracking-wide text-green-700 font-semibold"
            >
              Notificaciones
            </p>
            <h2 class="mt-2 text-3xl font-extrabold text-[#0D1440]">
              {{ notificationLabel }}
            </h2>
            <span class="mt-1 text-xs text-green-700 block">
              Estado general de avisos
            </span>
          </div>

          <div
            class="rounded-2xl border border-red-200 bg-red-50 shadow-sm p-5 text-center"
          >
            <p
              class="text-xs uppercase tracking-wide text-red-700 font-semibold"
            >
              Última sesión
            </p>
            <h2 class="mt-2 text-3xl font-extrabold text-[#0D1440]">
              {{ lastSession }}
            </h2>
            <span class="mt-1 text-xs text-red-700 block">
              Fecha y hora del último acceso
            </span>
          </div>
        </section>

        <section class="border border-gray-200 rounded-2xl overflow-hidden">
          <div
            class="px-6 py-4 border-b border-gray-200 flex items-center justify-between"
          >
            <h2 class="text-lg font-semibold text-[#0D1440]">
              Actividades recientes
            </h2>
            <span class="text-xs text-gray-400">
              Mostrando últimas 10 actividades
            </span>
          </div>

          <div class="px-6 py-4 max-h-[380px] overflow-y-auto bg-white">
            <ng-container
              *ngIf="recent && recent.length > 0; else emptyActivities"
            >
              <ul class="divide-y divide-gray-100">
                <li
                  *ngFor="let a of recent; let i = index"
                  class="py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3"
                >
                  <div class="min-w-0">
                    <p class="text-sm font-semibold text-gray-900 truncate">
                      Actividad {{ i + 1 }} — {{ a.titulo }}
                    </p>
                    <p class="text-xs text-gray-600 truncate mt-0.5">
                      {{ a.detalle }} · {{ formatDMY(a.fecha) }} ·
                      {{ a.horas }} h
                    </p>
                  </div>

                  <span
                    class="text-[11px] px-3 py-1 rounded-full border font-medium"
                    [ngClass]="{
                      'bg-emerald-50 text-emerald-700 border-emerald-200':
                        a.estado === 'Aprobada',
                      'bg-amber-50 text-amber-700 border-amber-200':
                        a.estado === 'Pendiente',
                      'bg-red-50 text-red-700 border-red-200':
                        a.estado === 'Rechazada'
                    }"
                  >
                    {{ a.estado }}
                  </span>
                </li>
              </ul>
            </ng-container>

            <ng-template #emptyActivities>
              <div class="py-6 text-center text-sm text-gray-500">
                Aún no tienes actividades registradas.
              </div>
            </ng-template>
          </div>
        </section>
      </div>
    </div>

    <div
      *ngIf="showDetails"
      class="fixed inset-0 z-[100] flex items-center justify-center"
      role="dialog"
      aria-modal="true"
      aria-labelledby="dialog-title"
    >
      <div class="absolute inset-0 bg-black/40" (click)="closeDetails()"></div>

      <div
        class="relative bg-white rounded-2xl shadow-2xl border border-gray-200 max-w-xl w-[90%]"
      >
        <div
          class="px-6 py-4 border-b border-gray-200 rounded-t-2xl text-center bg-gray-50"
        >
          <h3
            id="dialog-title"
            class="text-xl md:text-2xl font-semibold text-[#0D1440]"
          >
            Descripción del cargo
          </h3>
        </div>

        <div class="px-6 py-5">
          <p class="text-sm text-gray-600 mb-4">
            Rol y responsabilidades del funcionario:
          </p>

          <ng-container *ngIf="cargoDescripcion?.length; else noDescripcion">
            <ul
              class="list-disc pl-5 space-y-2 text-gray-700 text-sm md:text-base"
            >
              <li *ngFor="let punto of cargoDescripcion">
                {{ punto }}
              </li>
            </ul>
          </ng-container>

          <ng-template #noDescripcion>
            <p class="text-sm text-gray-500">
              No se encontró una descripción de cargo asociada a este rol.
            </p>
          </ng-template>
        </div>

        <div class="px-6 pb-6">
          <button
            type="button"
            (click)="closeDetails()"
            class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-lg bg-[#0D1440] text-white font-semibold hover:bg-[#1E2768] focus:outline-none focus:ring-4 focus:ring-blue-200"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </section>
</app-layout>
