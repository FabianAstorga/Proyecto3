<app-layout [logoutLink]="'/login'">
  <section
    class="min-h-[calc(100vh-32px)] px-4 py-6 md:px-8 md:py-8 bg-slate-50 dark:bg-gradient-to-b dark:from-slate-950 dark:via-slate-950 dark:to-slate-900"
  >
    <div
      class="h-full w-full overflow-hidden rounded-3xl border border-slate-200 bg-white text-slate-900 shadow-[0_24px_60px_rgba(15,23,42,0.08)] dark:border-slate-800 dark:bg-slate-950/80 dark:text-slate-100 dark:shadow-[0_24px_60px_rgba(15,23,42,0.8)] dark:backdrop-blur-sm"
    >
      <!-- HEADER COMÚN -->
      <header
        class="flex flex-col gap-4 border-b border-slate-200 bg-white px-6 py-4 lg:flex-row lg:items-center lg:justify-between lg:px-10 dark:border-slate-800 dark:bg-slate-950/80"
      >
        <div class="flex items-center gap-4">
          <div
            class="flex h-28 w-28 items-center justify-center rounded-full bg-slate-100 ring-4 ring-slate-200 overflow-hidden dark:bg-slate-900 dark:ring-slate-700"
          >
            <img
              *ngIf="userAvatar"
              [src]="userAvatar"
              alt="avatar"
              class="h-full w-full object-cover"
            />
          </div>

          <div>
            <p class="text-4xl font-semibold">
              {{ user?.firstName }} {{ user?.lastName }}
            </p>
            <p
              class="text-2xl text-slate-500 dark:text-slate-300 leading-none m-0"
            >
              {{ user?.role }}
            </p>
            <p
              class="text-2xl text-slate-500 dark:text-slate-300 leading-none m-0"
            >
              {{ user?.email }}
            </p>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <div
            class="hidden text-2xl text-slate-600 dark:text-slate-300 md:block"
          >
            <p class="font-medium text-slate-900 dark:text-slate-200">
              Última sesión
            </p>
            <p class="mt-0.5 text-2xl text-slate-500 dark:text-slate-400">
              {{ lastSession }}
            </p>
          </div>

          <button
            type="button"
            (click)="openDetails()"
            class="inline-flex items-center justify-center rounded-xl bg-indigo-600 px-5 py-2.5 text-2xl font-semibold text-white shadow-md shadow-indigo-500/30 transition hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-slate-900"
          >
            Ver detalles del cargo
          </button>
        </div>
      </header>

      <!-- ================= KPIs POR ROL ================= -->
      <section
        class="border-b text-center border-slate-200 bg-slate-50 px-6 py-6 lg:px-10 dark:border-slate-800 dark:bg-gradient-to-r dark:from-slate-950 dark:via-slate-900 dark:to-slate-950"
      >
        <ng-container [ngSwitch]="mode">
          <!-- FUNCIONARIO -->
          <div *ngSwitchCase="'Funcionario'" class="grid gap-4 md:grid-cols-4">
            <!-- Total actividades -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Total actividades</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-sky-400"
                ></span>
              </div>
              <p
                class="text-3xl text-center font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ activitiesCount }}
              </p>
            </div>

            <!-- Actividades del mes -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades del mes</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-emerald-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ monthActivitiesCount }}
              </p>
            </div>

            <!-- Pendientes -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex text-center items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades pendientes</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-amber-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ pendingCount }}
              </p>
            </div>

            <!-- Aprobadas -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades aprobadas</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-green-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ approvedCount }}
              </p>
            </div>
          </div>

          <!-- SECRETARÍA -->
          <div *ngSwitchCase="'Secretaria'" class="grid gap-4 md:grid-cols-4">
            <!-- Total actividades -->
            <div
              class="rounded-2xl text-center border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Total actividades</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-sky-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ secretaryTotalActivities }}
              </p>
            </div>

            <!-- Pendientes por revisar -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Pendientes por revisar</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-amber-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ secretaryPendingCount }}
              </p>
            </div>

            <!-- Aprobadas -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades aprobadas</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-emerald-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ secretaryApprovedCount }}
              </p>
            </div>

            <!-- Eventos próximos -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Eventos próximos</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-sky-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ secretaryUpcomingEventsCount }}
              </p>
            </div>
          </div>

          <!-- ADMINISTRADOR -->
          <div
            *ngSwitchCase="'Administrador'"
            class="grid gap-4 md:grid-cols-4"
          >
            <!-- Total actividades -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex text-center items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Total actividades</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-sky-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ adminTotalActivities }}
              </p>
            </div>

            <!-- Actividades del mes (global) -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades del mes</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-emerald-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ adminMonthActivities }}
              </p>
            </div>

            <!-- Pendientes (global) -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades pendientes</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-amber-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ adminPendingCount }}
              </p>
            </div>

            <!-- Aprobadas (global) -->
            <div
              class="rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm dark:border-slate-800 dark:bg-slate-950/70"
            >
              <div
                class="flex items-center justify-between text-2xl text-slate-500 dark:text-slate-400"
              >
                <span>Actividades aprobadas</span>
                <span
                  class="inline-flex h-2 w-2 rounded-full bg-green-400"
                ></span>
              </div>
              <p
                class="text-3xl font-semibold mt-3 text-slate-900 dark:text-white"
              >
                {{ adminApprovedCount }}
              </p>
            </div>
          </div>
        </ng-container>
      </section>

      <!-- ================= ACCIONES + RESÚMENES + RECORDATORIOS ================= -->
      <section
        class="border-b border-slate-200 bg-white px-6 py-6 lg:px-10 dark:border-slate-800 dark:bg-slate-950/80"
      >
        <div class="grid gap-6 lg:grid-cols-3">
          <!-- ACCIONES RÁPIDAS POR ROL -->
          <div
            class="rounded-2xl border border-slate-200 bg-slate-50 px-5 py-5 dark:border-slate-800 dark:bg-slate-950/80"
          >
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">
              Acciones rápidas
            </h2>

            <ng-container [ngSwitch]="mode">
              <!-- FUNCIONARIO -->
              <div
                class="mt-4 flex flex-col gap-3"
                *ngSwitchCase="'Funcionario'"
              >
                <a
                  [routerLink]="[
                    '/funcionario',
                    user?.id,
                    'actividades',
                    'nueva'
                  ]"
                  class="inline-flex h-12 items-center justify-center rounded-xl bg-indigo-600 text-white text-2xl font-semibold hover:bg-indigo-500"
                >
                  Registrar nueva actividad
                </a>

                <a
                  [routerLink]="[
                    '/funcionario',
                    user?.id,
                    'actividades',
                    'historial'
                  ]"
                  class="inline-flex h-12 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 text-2xl font-semibold hover:border-slate-400 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-slate-500 dark:hover:bg-slate-800"
                >
                  Ver historial completo
                </a>
                <a
                  routerLink="/reportes"
                  class="inline-flex h-12 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 text-2xl font-semibold hover:border-slate-400 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-slate-500 dark:hover:bg-slate-800"
                >
                  Descargar reportes
                </a>
              </div>

              <!-- SECRETARÍA -->
              <div
                class="mt-4 flex flex-col gap-3"
                *ngSwitchCase="'Secretaria'"
              >
                <a
                  [routerLink]="[
                    '/secretaria',
                    user?.id,
                    'actividades',
                    'historial'
                  ]"
                  class="inline-flex h-12 items-center justify-center rounded-xl bg-indigo-600 text-white text-2xl font-semibold hover:bg-indigo-500"
                >
                  Ver informe / historial
                </a>

                <a
                  [routerLink]="['/secretaria', user?.id, 'calendario']"
                  class="inline-flex h-12 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 text-2xl font-semibold hover:border-slate-400 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-slate-500 dark:hover:bg-slate-800"
                >
                  Gestionar calendario
                </a>

                <a
                  [routerLink]="['/secretaria', user?.id, 'horario']"
                  class="inline-flex h-12 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 text-2xl font-semibold hover:border-slate-400 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-slate-500 dark:hover:bg-slate-800"
                >
                  Ver horario
                </a>
              </div>

              <!-- ADMINISTRADOR -->
              <div
                class="mt-4 flex flex-col gap-3"
                *ngSwitchCase="'Administrador'"
              >
                <a
                  [routerLink]="['/admin', user?.id, 'funcionarios']"
                  class="inline-flex h-12 items-center justify-center rounded-xl bg-indigo-600 text-white text-2xl font-semibold hover:bg-indigo-500"
                >
                  Gestionar funcionarios
                </a>

                <a
                  [routerLink]="['/admin', user?.id, 'cargos']"
                  class="inline-flex h-12 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 text-2xl font-semibold hover:border-slate-400 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-slate-500 dark:hover:bg-slate-800"
                >
                  Gestionar cargos
                </a>

                <a
                  [routerLink]="['/admin', user?.id, 'calendario']"
                  class="inline-flex h-12 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 text-2xl font-semibold hover:border-slate-400 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:border-slate-500 dark:hover:bg-slate-800"
                >
                  Gestionar calendario
                </a>
              </div>
            </ng-container>
          </div>

          <!-- RESÚMENES POR ROL -->
          <div class="flex flex-col gap-4">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">
              Resumen del mes
            </h2>

            <ng-container [ngSwitch]="mode">
              <!-- FUNCIONARIO -->
              <div
                class="grid gap-4 sm:grid-cols-2"
                *ngSwitchCase="'Funcionario'"
              >
                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Actividades del mes
                  </p>
                  <p
                    class="text-3xl font-semibold text-slate-900 dark:text-white mt-2"
                  >
                    {{ monthActivitiesCount }}
                  </p>
                </div>

                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Actividades pendientes
                  </p>
                  <p
                    class="text-3xl font-semibold text-slate-900 dark:text-white mt-2"
                  >
                    {{ pendingCount }}
                  </p>
                </div>

                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Última actividad registrada
                  </p>
                  <p class="text-3xl text-slate-800 dark:text-slate-200 mt-2">
                    {{ lastActivity?.titulo || "Sin actividades registradas" }}
                  </p>
                </div>

                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Actividad más frecuente del mes
                  </p>
                  <p class="text-3xl text-slate-800 dark:text-slate-200 mt-2">
                    {{ mostFrequentTitle || "No hay registros suficientes" }}
                  </p>
                </div>
              </div>

              <!-- SECRETARÍA -->
              <div
                class="grid gap-4 sm:grid-cols-2"
                *ngSwitchCase="'Secretaria'"
              >
                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Total actividades a gestionar
                  </p>
                  <p
                    class="text-3xl font-semibold text-slate-900 dark:text-white mt-2"
                  >
                    {{ secretaryTotalActivities }}
                  </p>
                </div>

                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Pendientes por revisar
                  </p>
                  <p
                    class="text-3xl font-semibold text-slate-900 dark:text-white mt-2"
                  >
                    {{ secretaryPendingCount }}
                  </p>
                </div>
              </div>

              <!-- ADMINISTRADOR -->
              <div
                *ngSwitchCase="'Administrador'"
                class="grid gap-4 sm:grid-cols-1"
              >
                <div
                  class="rounded-2xl border border-slate-200 bg-slate-50 px-4 py-3 dark:border-slate-800 dark:bg-slate-900/60"
                >
                  <p class="text-2xl text-slate-500 dark:text-slate-400">
                    Cargos definidos en el sistema
                  </p>
                  <p
                    class="text-3xl text-center font-semibold text-slate-900 dark:text-white mt-2"
                  >
                    {{ adminCargosCount }}
                  </p>
                </div>
              </div>
            </ng-container>
          </div>

          <!-- RECORDATORIOS POR ROL -->
          <div
            class="rounded-2xl border border-slate-200 bg-slate-50 px-5 py-5 dark:border-slate-800 dark:bg-slate-950/80"
          >
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">
              Recordatorios
            </h2>

            <ul
              class="mt-3 space-y-3 text-2xl text-slate-700 dark:text-slate-200 leading-relaxed"
            >
              <ng-container [ngSwitch]="mode">
                <!-- FUNCIONARIO -->
                <ng-container *ngSwitchCase="'Funcionario'">
                  <li class="flex gap-3">
                    <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
                    <span>{{ notificationLabel }}</span>
                  </li>

                  <li class="flex gap-3">
                    <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                    <span>
                      Tienes <strong>{{ pendingCount }}</strong> actividad(es)
                      pendiente(s).
                    </span>
                  </li>

                  <li class="flex gap-3" *ngIf="daysSinceLastActivity !== null">
                    <span class="h-2 w-2 rounded-full bg-sky-400"></span>
                    <span>
                      Última actividad registrada hace
                      <strong>{{ daysSinceLastActivity }}</strong> día(s).
                    </span>
                  </li>
                </ng-container>

                <!-- SECRETARÍA -->
                <ng-container *ngSwitchCase="'Secretaria'">
                  <li class="flex gap-3">
                    <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
                    <span>{{ notificationLabel }}</span>
                  </li>

                  <li class="flex gap-3">
                    <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                    <span>
                      Tienes
                      <strong>{{ secretaryPendingCount }}</strong>
                      actividad(es) pendiente(s) por funcionario.
                    </span>
                  </li>

                  <li
                    class="flex gap-3"
                    *ngIf="secretaryUpcomingEventsCount > 0"
                  >
                    <span class="h-2 w-2 rounded-full bg-sky-400"></span>
                    <span>
                      Hay
                      <strong>{{ secretaryUpcomingEventsCount }}</strong>
                      evento(s) próximo(s) en el calendario.
                    </span>
                  </li>
                </ng-container>

                <!-- ADMINISTRADOR -->
                <ng-container *ngSwitchCase="'Administrador'">
                  <li class="flex gap-3">
                    <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
                    <span>{{ notificationLabel }}</span>
                  </li>

                  <li class="flex gap-3">
                    <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                    <span>
                      Hay
                      <strong>{{ adminPendingCount }}</strong> actividad(es)
                      pendiente(s) en toda la institución.
                    </span>
                  </li>
                </ng-container>
              </ng-container>
            </ul>
          </div>
        </div>
      </section>

      <!-- ================= ACTIVIDADES RECIENTES / PENDIENTES ================= -->
      <section
        class="flex h-[calc(100%-340px)] flex-col bg-slate-50 px-6 py-6 lg:px-10 dark:bg-slate-950/80"
      >
        <div class="mb-4 flex items-center justify-between">
          <h2 class="text-2xl font-semibold text-slate-900 dark:text-white">
            Actividades recientes
          </h2>

          <span
            class="text-2xl text-slate-500 dark:text-slate-400"
            *ngIf="mode === 'Funcionario'"
          >
            Últimas 10 actividades
          </span>
          <span
            class="text-2xl text-slate-500 dark:text-slate-400"
            *ngIf="mode === 'Secretaria'"
          >
            Actividades pendientes por funcionario
          </span>
          <span
            class="text-2xl text-slate-500 dark:text-slate-400"
            *ngIf="mode === 'Administrador'"
          >
            Actividades globales recientes
          </span>
        </div>

        <div
          class="flex-1 overflow-y-auto rounded-2xl border border-slate-200 bg-white dark:border-slate-800 dark:bg-slate-950/90"
        >
          <ng-container [ngSwitch]="mode">
            <!-- FUNCIONARIO -->
            <ng-container *ngSwitchCase="'Funcionario'">
              <ng-container *ngIf="recent.length > 0; else emptyActivities">
                <ul class="divide-y divide-slate-200 dark:divide-slate-800">
                  <li
                    *ngFor="let a of recent; let i = index"
                    class="flex flex-col gap-3 px-4 py-4 text-2xl text-slate-800 hover:bg-slate-50 transition md:flex-row md:items-center md:justify-between dark:text-slate-100 dark:hover:bg-slate-900/80"
                  >
                    <div class="min-w-0 flex-1">
                      <p
                        class="flex items-center gap-2 text-2xl uppercase text-slate-500 dark:text-slate-500"
                      >
                        <span
                          class="h-6 w-6 rounded-full bg-slate-100 flex items-center justify-center text-2xl text-slate-600 dark:bg-slate-900 dark:text-slate-300"
                        >
                          {{ i + 1 }}
                        </span>
                        Actividad {{ i + 1 }}
                      </p>
                      <p
                        class="mt-1 text-2xl font-bold text-slate-900 dark:text-white truncate"
                      >
                        {{ a.titulo }}
                      </p>
                      <p
                        class="mt-1 text-2xl text-slate-500 dark:text-slate-400 truncate"
                      >
                        {{ a.detalle }} · {{ formatDMY(a.fecha) }}
                      </p>
                    </div>

                    <div class="flex items-center gap-4">
                      <button
                        (click)="openActivity(a)"
                        class="w-24 rounded-lg border border-indigo-300 px-4 py-1.5 text-2xl font-medium text-indigo-600 hover:bg-indigo-50 dark:border-indigo-500 dark:text-indigo-300 dark:hover:bg-indigo-500/10"
                      >
                        Ver
                      </button>

                      <span class="text-2xl text-slate-500 dark:text-slate-400">
                        {{ formatDMY(a.fecha) }}
                      </span>
                      <span
                        class="text-2xl px-3 py-1 rounded-full border font-medium"
                        [ngClass]="{
                          'bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-500/15 dark:text-emerald-300 dark:border-emerald-500/40':
                            a.estado === 'Aprobada',
                          'bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/15 dark:text-amber-200 dark:border-amber-500/40':
                            a.estado === 'Pendiente',
                          'bg-red-50 text-red-700 border-red-200 dark:bg-red-500/15 dark:text-red-300 dark:border-red-500/40':
                            a.estado === 'Rechazada'
                        }"
                      >
                        {{ a.estado }}
                      </span>
                    </div>
                  </li>
                </ul>
              </ng-container>
            </ng-container>

            <!-- SECRETARÍA: sólo pendientes por funcionario -->
            <ng-container *ngSwitchCase="'Secretaria'">
              <ng-container
                *ngIf="
                  secretaryPendingActivities.length > 0;
                  else emptyActivities
                "
              >
                <ul class="divide-y divide-slate-200 dark:divide-slate-800">
                  <li
                    *ngFor="let a of secretaryPendingActivities; let i = index"
                    class="flex flex-col gap-3 px-4 py-4 text-2xl text-slate-800 hover:bg-slate-50 transition md:flex-row md:items-center md:justify-between dark:text-slate-100 dark:hover:bg-slate-900/80"
                  >
                    <div class="min-w-0 flex-1">
                      <p
                        class="flex items-center font-bold gap-2 text-2xl uppercase text-slate-500 dark:text-slate-500"
                      >
                        <span
                          class="h-6 w-6 rounded-full bg-slate-100 flex items-center justify-center text-2xl text-slate-600 dark:bg-slate-900 dark:text-slate-300"
                        >
                          {{ i + 1 }}
                        </span>
                        {{ a.userName || "Funcionario" }}
                      </p>
                      <p
                        class="mt-1 text-2xl font-medium text-slate-900 dark:text-white truncate"
                      >
                        {{ a.titulo }}
                      </p>
                      <p
                        class="mt-1 text-2xl text-slate-500 dark:text-slate-400 truncate"
                      >
                        {{ a.detalle }} · {{ formatDMY(a.fecha) }}
                      </p>
                    </div>

                    <div class="flex items-center gap-4">
                      <button
                        (click)="openActivity(a)"
                        class="w-24 rounded-lg border border-indigo-300 px-4 py-1.5 text-2xl font-medium text-indigo-600 hover:bg-indigo-50 dark:border-indigo-500 dark:text-indigo-300 dark:hover:bg-indigo-500/10"
                      >
                        Ver
                      </button>

                      <span class="text-2xl text-slate-500 dark:text-slate-400">
                        {{ formatDMY(a.fecha) }}
                      </span>
                      <span
                        class="text-2xl px-3 py-1 rounded-full border font-medium bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/15 dark:text-amber-200 dark:border-amber-500/40"
                      >
                        Pendiente
                      </span>
                    </div>
                  </li>
                </ul>
              </ng-container>
            </ng-container>

            <!-- ADMINISTRADOR: actividades globales -->
            <ng-container *ngSwitchCase="'Administrador'">
              <ng-container
                *ngIf="adminRecentActivities.length > 0; else emptyActivities"
              >
                <ul class="divide-y divide-slate-200 dark:divide-slate-800">
                  <li
                    *ngFor="let a of adminRecentActivities; let i = index"
                    class="flex flex-col gap-3 px-4 py-4 text-2xl text-slate-800 hover:bg-slate-50 transition md:flex-row md:items-center md:justify-between dark:text-slate-100 dark:hover:bg-slate-900/80"
                  >
                    <div class="min-w-0 flex-1">
                      <p
                        class="flex items-center gap-2 text-xl font-bold uppercase text-slate-500 dark:text-slate-500"
                      >
                        <span
                          class="h-6 w-6 rounded-full bg-slate-100 flex items-center justify-center text-2xl text-slate-600 dark:bg-slate-900 dark:text-slate-300"
                        >
                          {{ i + 1 }}
                        </span>
                        {{ a.userName || "Funcionario" }}
                      </p>
                      <p
                        class="mt-1 text-2xl font-bold text-slate-900 dark:text-white truncate"
                      >
                        {{ a.titulo }}
                      </p>
                      <p
                        class="mt-1 text-2xl text-slate-500 dark:text-slate-400 truncate"
                      >
                        {{ a.detalle }} · {{ formatDMY(a.fecha) }}
                      </p>
                    </div>

                    <div class="flex items-center gap-4">
                      <button
                        (click)="openActivity(a)"
                        class="w-24 rounded-lg border border-indigo-300 px-4 py-1.5 text-2xl font-medium text-indigo-600 hover:bg-indigo-50 dark:border-indigo-500 dark:text-indigo-300 dark:hover:bg-indigo-500/10"
                      >
                        Ver
                      </button>

                      <span class="text-2xl text-slate-500 dark:text-slate-400">
                        {{ formatDMY(a.fecha) }}
                      </span>
                      <span
                        class="text-2xl px-3 py-1 rounded-full border font-medium"
                        [ngClass]="{
                          'bg-emerald-50 text-emerald-700 border-emerald-200 dark:bg-emerald-500/15 dark:text-emerald-300 dark:border-emerald-500/40':
                            a.estado === 'Aprobada',
                          'bg-amber-50 text-amber-700 border-amber-200 dark:bg-amber-500/15 dark:text-amber-200 dark:border-amber-500/40':
                            a.estado === 'Pendiente',
                          'bg-red-50 text-red-700 border-red-200 dark:bg-red-500/15 dark:text-red-300 dark:border-red-500/40':
                            a.estado === 'Rechazada'
                        }"
                      >
                        {{ a.estado }}
                      </span>
                    </div>
                  </li>
                </ul>
              </ng-container>
            </ng-container>

            <!-- EMPTY -->
            <ng-template #emptyActivities>
              <div
                class="h-full flex items-center justify-center text-2xl text-slate-500 dark:text-slate-400"
              >
                No hay actividades para mostrar.
              </div>
            </ng-template>
          </ng-container>
        </div>
      </section>
    </div>

    <!-- MODAL DESCRIPCIÓN CARGO -->
    <div
      *ngIf="showDetails"
      class="fixed inset-0 z-[100] flex items-center justify-center"
    >
      <div class="absolute inset-0 bg-black/40" (click)="closeDetails()"></div>

      <div
        class="relative w-[90%] max-w-xl rounded-2xl border border-slate-200 bg-white text-slate-900 shadow-2xl dark:border-slate-800 dark:bg-slate-950/95 dark:text-slate-100 dark:backdrop-blur-md"
      >
        <div
          class="px-6 py-4 border-b border-slate-200 text-center bg-slate-50 dark:border-slate-800 dark:bg-slate-900/80"
        >
          <h3 class="text-2xl font-semibold">Descripción del cargo</h3>
        </div>

        <div class="px-6 py-5">
          <p class="text-2xl text-slate-600 dark:text-slate-300 mb-4">
            Rol y responsabilidades del funcionario:
          </p>

          <ng-container *ngIf="cargoDescripcion?.length; else noDesc">
            <ul
              class="list-disc pl-5 space-y-2 text-slate-800 dark:text-slate-200 text-base"
            >
              <li *ngFor="let p of cargoDescripcion">
                {{ p }}
              </li>
            </ul>
          </ng-container>

          <ng-template #noDesc>
            <p class="text-2xl text-slate-500 dark:text-slate-400">
              No hay descripción disponible.
            </p>
          </ng-template>
        </div>

        <div class="px-6 pb-6">
          <button
            (click)="closeDetails()"
            class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-xl bg-indigo-600 text-white font-semibold hover:bg-indigo-500"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>

    <!-- ================= MODAL VER ACTIVIDAD ================= -->
    <div
      *ngIf="showActivityModal && selectedActivity"
      class="fixed inset-0 z-[120] flex items-center justify-center"
    >
      <!-- Fondo -->
      <div
        class="absolute inset-0 bg-black/50 backdrop-blur-sm"
        (click)="closeActivity()"
      ></div>

      <!-- Contenedor -->
      <div
        class="relative w-[90%] max-w-4xl rounded-2xl border border-slate-200 bg-white text-slate-900 shadow-2xl dark:border-slate-800 dark:bg-slate-950 dark:text-slate-100"
      >
        <!-- Header -->
        <div
          class="flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/80"
        >
          <h3 class="text-xl font-semibold">Detalle de la actividad</h3>
          <button
            (click)="closeActivity()"
            class="text-slate-500 hover:text-slate-900 dark:hover:text-white text-2xl"
          >
            ✕
          </button>
        </div>

        <!-- Body horizontal -->
        <div class="px-6 py-5 grid grid-cols-2 gap-6 text-lg">
          <!-- Columna izquierda -->
          <div class="space-y-4">
            <div>
              <p class="font-semibold">Título</p>
              <p class="text-slate-600 dark:text-slate-300">
                {{ selectedActivity.titulo }}
              </p>
            </div>

            <div>
              <p class="font-semibold">Detalle</p>
              <p class="text-slate-600 dark:text-slate-300">
                {{ selectedActivity.detalle }}
              </p>
            </div>
          </div>

          <!-- Columna derecha -->
          <div class="space-y-4">
            <div>
              <p class="font-semibold">Fecha</p>
              <p>{{ formatDMY(selectedActivity.fecha) }}</p>
            </div>

            <div>
              <p class="font-semibold">Estado</p>
              <p>{{ selectedActivity.estado }}</p>
            </div>

            <div *ngIf="selectedActivity.tipo">
              <p class="font-semibold">Tipo</p>
              <p>{{ selectedActivity.tipo }}</p>
            </div>

            <div *ngIf="selectedActivity.userName">
              <p class="font-semibold">Funcionario</p>
              <p>{{ selectedActivity.userName }}</p>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="px-6 pb-6 flex justify-end">
          <button
            (click)="closeActivity()"
            class="rounded-xl bg-indigo-600 px-8 py-2 text-lg font-semibold text-white hover:bg-indigo-500"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </section>
</app-layout>
