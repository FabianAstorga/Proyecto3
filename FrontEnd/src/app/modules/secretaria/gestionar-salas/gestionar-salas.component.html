<app-layout [navItems]="secretariaNavItems" logoutLink="/login">
  <section class="max-w-4xl mx-auto py-6">
    <div class="bg-white border border-gray-200 rounded-2xl shadow-lg p-8">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-extrabold text-[#0D1440]">
          ⚙️ Crear/Editar Sala
        </h2>
        <p class="text-gray-500 mt-1">
          Ingrese los atributos de la nueva sala para su registro.
        </p>
      </div>

      <form [formGroup]="salaForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Campos Nombre & Ubicación -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="nombre" class="block text-sm font-medium text-gray-700"
              >Nombre de la Sala</label
            >
            <input
              id="nombre"
              type="text"
              formControlName="nombre"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Ej: Laboratorio B-201"
            />
            <div
              *ngIf="
                salaForm.get('nombre')?.invalid &&
                (salaForm.get('nombre')?.dirty ||
                  salaForm.get('nombre')?.touched)
              "
              class="text-red-500 text-xs mt-1"
            >
              <span *ngIf="salaForm.get('nombre')?.errors?.['required']"
                >El nombre es obligatorio.</span
              >
            </div>
          </div>

          <div>
            <label
              for="ubicacion"
              class="block text-sm font-medium text-gray-700"
              >Ubicación / Campus</label
            >
            <input
              id="ubicacion"
              type="text"
              formControlName="ubicacion"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Ej: Campus Saucache, Edificio I"
            />
            <div
              *ngIf="
                salaForm.get('ubicacion')?.invalid &&
                (salaForm.get('ubicacion')?.dirty ||
                  salaForm.get('ubicacion')?.touched)
              "
              class="text-red-500 text-xs mt-1"
            >
              <span *ngIf="salaForm.get('ubicacion')?.errors?.['required']"
                >La ubicación es obligatoria.</span
              >
            </div>
          </div>
        </div>

        <!-- Capacidad & Código -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label
              for="capacidadMax"
              class="block text-sm font-medium text-gray-700"
              >Capacidad Máxima (personas)</label
            >
            <input
              id="capacidadMax"
              type="number"
              formControlName="capacidadMax"
              min="1"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Mínimo 1"
            />
            <div
              *ngIf="
                salaForm.get('capacidadMax')?.invalid &&
                (salaForm.get('capacidadMax')?.dirty ||
                  salaForm.get('capacidadMax')?.touched)
              "
              class="text-red-500 text-xs mt-1"
            >
              <span *ngIf="salaForm.get('capacidadMax')?.errors?.['required']"
                >La capacidad es obligatoria.</span
              >
              <span *ngIf="salaForm.get('capacidadMax')?.errors?.['min']"
                >Debe ser al menos 1 persona.</span
              >
            </div>
          </div>

          <div>
            <label for="codigo" class="block text-sm font-medium text-gray-700"
              >Código de Identificación</label
            >
            <input
              id="codigo"
              type="text"
              formControlName="codigo"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Ej: LAB201"
            />
            <div
              *ngIf="
                salaForm.get('codigo')?.invalid &&
                (salaForm.get('codigo')?.dirty ||
                  salaForm.get('codigo')?.touched)
              "
              class="text-red-500 text-xs mt-1"
            >
              <span *ngIf="salaForm.get('codigo')?.errors?.['required']"
                >El código es obligatorio.</span
              >
            </div>
          </div>
        </div>

        <!-- Upload Imagen del Mapa y QR -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Subir Imagen del Mapa (Opcional)</label
            >
            <div
              class="border-2 border-dashed rounded-md p-6 mt-1 text-center cursor-pointer transition-colors duration-200"
              [ngClass]="{
                'border-blue-500 bg-blue-50': isDragging,
                'border-gray-300 hover:border-gray-400': !isDragging
              }"
              (dragover)="handleDragOver($event)"
              (dragleave)="handleDragLeave($event)"
              (drop)="handleDrop($event)"
              (click)="fileInput.click()"
            >
              <p class="text-gray-600 mb-2">
                <span class="font-bold">Arrastra y suelta aquí</span> el plano,
                o haz click para seleccionar.
              </p>

              <input
                #fileInput
                type="file"
                accept="image/*"
                (change)="handleFileInput($event)"
                class="hidden"
              />

              <div *ngIf="selectedMapFile" class="mt-2 relative">
                <button
                  type="button"
                  (click)="removeSelectedImage()"
                  class="absolute top-0 right-0 text-red-600 font-bold rounded-full bg-white shadow p-1 hover:bg-red-100 transition"
                >
                  ✕
                </button>
                <p class="text-sm font-semibold text-green-600">
                  Archivo seleccionado: {{ selectedMapFile.name }}
                </p>
                <img
                  *ngIf="mapPreview"
                  [src]="mapPreview"
                  alt="Vista previa"
                  class="mt-2 mx-auto max-h-40 rounded-md shadow-sm"
                />
              </div>
            </div>
            <p class="text-gray-400 text-xs mt-1">
              Sube una imagen (PNG, JPG, GIF, etc.) del plano de ubicación de la
              sala.
            </p>
          </div>

          <div>
            <label for="QR" class="block text-sm font-medium text-gray-700"
              >URL del Código QR (Opcional)</label
            >
            <input
              id="QR"
              type="url"
              formControlName="QR"
              class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500"
              placeholder="https://qrcodes.com/sala-xyz..."
            />
            <p class="text-gray-400 text-xs mt-1">
              URL de la imagen o recurso del código QR.
            </p>
          </div>
        </div>

        <div class="pt-4">
          <button
            type="submit"
            [disabled]="salaForm.invalid"
            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150"
          >
            Registrar Sala
          </button>
        </div>
      </form>
    </div>
  </section>
</app-layout>
